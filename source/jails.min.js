define(function(){function t(t,n,e,o,r){var i=u(o),c=new t(e,i);n&&n.apply(c,[i,r]),c.init&&c.init()}function n(n){function e(e){e in s.components&&t(o,s.components[e],e,n)}var r=n.getAttribute("data-component").replace(/\s/,"").split(/\,/);r.forEach(e)}function e(n){return function(e){var o;o=e.getAttribute("data-"+n),t(i,s[n+"s"][o],o,e,p)}}function o(){r.apply(this,arguments)}function r(t,n){var e=this;this.name=t,this.emit=function(e,o){o=l.call(arguments),o.shift(),n.trigger(t+":"+e,{args:o,element:n[0]})},this.listen=function(t,o){if(o)n.on(t,function(t,n){o.apply(n.element,[t].concat(n.args))});else for(var r in t)e.listen(r,t[r])},n.on("execute",function(t,n){var o=[].concat(n.args),r=o.shift(),i=e[r];i&&i.apply(e,o),t.stopPropagation()}),n.on("instance",function(o,r){r.call(e,t,n)})}function i(t,n){r.apply(this,arguments);var e=n[0];this.watch=function(t,e,o){n.on(e,t,o)},this.x=function(t){return function(){var e=l.call(arguments);n.find(t).trigger("execute",{args:e})}},this.publish=function(t,n){n=l.call(arguments),n.shift(),f.trigger(t,{args:n,element:e})},this.subscribe=function(t,n){f.on(t,function(t,e){n.apply(e.element,[t].concat(e.args))})}}function c(){var t={};return{subscribe:function(){var n=l.call(arguments),e=n[0],o=n[1];t[e]=t[e]||[],t[e].push(o)},publish:function(){var n=l.call(arguments),e=n.shift();t[e]=t[e]||[],t[e].forEach(function(t){t&&t.apply(this,n)})}}}function a(t,n){return function(e,o){return s[t][e]=o,function(t,r){n.apply(this,[e,t]),o.apply(this,[t,r])}}}var s,u,l,p={},f=c();l=Array.prototype.slice,s={context:null,config:{},apps:{},controllers:{},components:{},app:a("apps",i),controller:a("controllers",i),component:a("components",o),publish:f.publish,subscribe:f.subscribe,start:function(t,n){u=t.base,this.context=u(document.documentElement),u.extend(!0,this.config,t),h.scan(n),this.context.addClass("ready")},refresh:function(t){h.start(t.get?t[0]:t)},data:function(){return p},scanner:function(){return h}};var h={scan:function(t){var n,e,o=this.entities;for(var r in o)n=o[r],e=l.call((t||document).querySelectorAll(n.selector)),e.forEach(n.method)},entities:{components:{selector:"[data-component]",method:n},controllers:{selector:"[data-controller]",method:e("controller")},app:{selector:"[data-app]",method:e("app")}}};return s});
