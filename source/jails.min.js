!function(t,e){"function"==typeof define&&define.amd?define("jails",e):"object"==typeof exports?module.exports=e(require("jails")):t.jails=e()}(this,function(){function t(n,r){return t.components[n]=function(t,i){var o=new e(n,t),c=r(o,t,i);return c?Object.assign(o,c):o}}function e(e,n){this.name=e,this.element=n,this._events={},t.events.on(n,"execute",o(this,e)),t.events.on(n,"destroy",c(this))}function n(e){function n(n){if(n in t.components){if(r(e,n))return;o=t.components[n](e,c[n]||{}),o.init&&o.init()}}var o,c=i(e),u=e.getAttribute("data-component").split(/\s/);l(u,n)}function r(t,e){var n=t["jails#component#"+e];return n?!0:(t["jails#component#"+e]=!0,!1)}function i(t){var e,n,r={};return e=t.previousSibling,e=e&&8==e.nodeType?e:e?e.previousSibling:null,e&&8==e.nodeType&&(n=e.data.replace(/@([a-zA-z0-9-\/]*)(?:\((.*)\))?/g,function(t,e,n){r[e]=Function("return "+n)()})),r}function o(t,e){return function(n){if(n.detail){var r,i,o,c;r=f(n.detail),i=r.shift(),o=i.split(/\:/),c=o.length>1&&o[0]==e?t[o[1]]:t[o[0]],c&&c.apply(t,r)}n.stopPropagation()}}function c(e){return function(n){for(var r in e._events)t.events.off(e.element,e._events[r]);for(r in e)e[r]=null;e=null,n.stopPropagation()}}function u(t){var e,n,r;for(e in t)for(n=t[e],n=n.push?n:[n],r=0;r<n.length;r++)this.on.apply(this,[e].concat(n[r]))}function s(){var t={},e={};return{subscribe:function(){var n=v.call(arguments),r=n[0],i=n[1],o=this;return r in e&&t[r]?(t[r].push(i),o.publish.apply(null,[r].concat(e[r]))):(t[r]=t[r]||[],t[r].push(i)),function(){var n=[],o=[];l(t[r],function(t){t!=i&&newarr.push(t)}),t[r]=n,l(e[r],function(t){t!=i&&newarr.push(t)}),e[r]=o}},publish:function(){var n=v.call(arguments),r=n.shift();t[r]=t[r]||[],t[r].length?l(t[r],function(t){t&&t.apply(this,n)}):e[r]=n}}}function a(){function t(t,e){var n=document.createEvent(t);return e=e||{},n.initEvent(t,e.bubbles||!1,e.cancelable||!1,e.detail||null),n}var e=function(){try{var t=new CustomEvent("c",{detail:{foo:"b"}});if("c"===t.type&&"b"===t.detail.foo)return CustomEvent}catch(e){return function(t,e){var n=document.createEvent("CustomEvent");return e=e||{},n.initCustomEvent(t,e.bubbles||!1,e.cancelable||!1,e.detail||null),n}}}();return{on:function(){return function(t,e,n){t.addEventListener(e,n,"focus"==e||"blur"==e)}}(),off:function(t,e,n){t.removeEventListener(e,n,!1)},trigger:function(n,r,i){try{n.dispatchEvent(new t(r,{bubbles:!0,detail:i}))}catch(o){n.dispatchEvent(new e(r,{bubbles:!0,detail:i}))}}}}function l(t,e){for(var n=0,r=t?t.length:0;r>n;n++)e(t[n],n)}function f(t){var e=function(){};return e.prototype=t,new e}var p=s(),v=Array.prototype.slice,h=(document.documentElement,/\*/),m=":";t.events=a(),t.publish=p.publish,t.subscribe=p.subscribe,t.data={},t.Component=e,t.components={},t.start=function(e){t.scanner.scan(e),t.publish("jails:ready")},t.refresh=function(e){t.scanner.scan(e)},t.render=function(e,n){t.scanner.scan(e,function(e){t.events.trigger(e,"destroy")}),e.innerHTML=n},t.scanner={entities:{components:{selector:"[data-component]",method:n}},scan:function(t,e){var n,r,i,o=this.entities;i=t||document;for(var c in o)n=o[c],r=v.call(i.querySelectorAll(n.selector)),l(r.reverse(),e||n.method)}},e.prototype.trigger=function(e,n,r){n&&n.constructor==String?l(this.element.querySelectorAll(n),function(n){t.events.trigger(n,e,r)}):t.events.trigger(this.element,e,r)},e.prototype.emit=function(e,n){var r={};r.instance=this,r.value=n,t.events.trigger(this.element,m+e,r)},e.prototype.listen=function(e,n){function r(t){var e=t.detail.instance;(h.test(c)||c==e.name)&&n.call(t.target,t,t.detail.value)}var i=this.element,o=e.split(":"),c=o.shift();return t.events.on(i,m+o.pop(),r),function(){t.events.off(i,e,r)}},e.prototype.on=function(e,n,r){if(r||(r=n,n=null),e.replace||u.call(this,e),/\:/.test(e))return this.listen(e,r);var i=this.element,o=this._events;return o[r]=function(t){if(!n)return r.call(i,t);for(var e=t.target;e&&e!=i&&e.parentNode;){if(e.matches?e.matches(n):b(e,n)){r.call(e,t);break}e=e.parentNode}},t.events.on(i,e,o[r]),function(){t.events.off(i,e,o[r]),delete o[r]}},e.prototype.publish=p.publish,e.prototype.subscribe=p.subscribe,e.prototype.get=function(e){function n(e){return function(){var n=v.call(arguments);l(r.querySelectorAll(e),function(e){t.events.trigger(e,"execute",n)}),(r.matches?r.matches(e):b(r,e))&&t.events.trigger(r,"execute",n)}}var r=this.element;return e=e.replace(/\//g,"\\/"),n(e)};var b=function(t){var e=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||function(t){return-1!==[].indexOf.call(document.querySelectorAll(t),this)};return function(t,n){return e.call(t,n)}}(document.body);return Object.assign||(Object.assign=function(t){t=Object(t);for(var e=1,n=arguments.length;n>e;e++){var r=arguments[e];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}),t});
