!function(a,b){"function"==typeof define&&define.amd?define("jails",b):"object"==typeof exports?module.exports=b(require("jails")):a.jails=b()}(this,function(){function d(a,b){d.components[a]=function(c,d){var f=new e(a,c);return b(f,c,d)||f}}function e(a,b){this.name=a,this.element=b,this._events={},d.events.on(b,"execute",i(this,a)),d.events.on(b,"destroy",j(this))}function f(a){function f(e){if(e in d.components){if(g(a,e))return;b=d.components[e](a,c[e]||{}),b.init&&b.init()}}var b,c=h(a),e=a.getAttribute("[data-component]").split(/\s/);m(e,f)}function g(a,b){var c=a["jails#component#"+b];return c?!0:(a["jails#component#"+b]=!0,!1)}function h(a){var c,d,b={};return c=a.previousSibling,c=c&&8==c.nodeType?c:c?c.previousSibling:null,c&&8==c.nodeType&&(d=c.data.replace(/[\n\t]/g,"").replace(/\@([a-zA-z0-9-\/]*)\(([^@]*)\)/g,function(a,c,d){b[c]=new Function("return "+d)()})),b}function i(a,b){return function(c){if(c.detail){var d,e,f,g;d=n(c.detail),e=d.shift(),f=e.split(/\:/),g=f.length>1&&f[0]==b?a[f[1]]:a[f[0]],g&&g.apply(a,d)}c.stopPropagation()}}function j(a){return function(b){for(var c in a._events)d.events.off(a.element,a._events[c]);for(c in a)a[c]=null;a=null,b.stopPropagation()}}function k(){var a={},c={};return{subscribe:function(){var d=b.call(arguments),e=d[0],f=d[1],g=this;return e in c&&a[e]?(a[e].push(f),g.publish.apply(null,[e].concat(c[e]))):(a[e]=a[e]||[],a[e].push(f)),function(){var b=[],d=[];m(a[e],function(a){a!=f&&newarr.push(a)}),a[e]=b,m(c[e],function(a){a!=f&&newarr.push(a)}),c[e]=d}},publish:function(){var d=b.call(arguments),e=d.shift();a[e]=a[e]||[],a[e].length?m(a[e],function(a){a&&a.apply(this,d)}):c[e]=d}}}function l(){function b(a,b){var c=document.createEvent(a);return b=b||{},c.initEvent(a,b.bubbles||!1,b.cancelable||!1,b.detail||null),c}var a=function(){try{var a=new CustomEvent("c",{detail:{foo:"b"}});if("c"===a.type&&"b"===a.detail.foo)return CustomEvent}catch(b){return function(a,b){var c=document.createEvent("CustomEvent");return b=b||{},c.initCustomEvent(a,b.bubbles||!1,b.cancelable||!1,b.detail||null),c}}}();return{on:function(){return function(a,b,c){a.addEventListener(b,c,"focus"==b||"blur"==b)}}(),off:function(a,b,c){a.removeEventListener(b,c,!1)},trigger:function(c,d,e){try{c.dispatchEvent(new b(d,{bubbles:!0,detail:e}))}catch(f){c.dispatchEvent(new a(d,{bubbles:!0,detail:e}))}}}}function m(a,b){for(var c=0,d=a?a.length:0;d>c;c++)b(a[c],c)}function n(a){var b=function(){};return b.prototype=a,new b}function o(a,b){for(var c=a.parentNode.querySelectorAll(b),d=c.length,e=0;d>e;e++)if(c[e]===a)return!0;return!1}var a=k(),b=Array.prototype.slice;document.documentElement;return d.events=l(),d.publish=a.publish,d.subscribe=a.subscribe,d.data={},d.Component=e,d.components={},d.start=function(a){d.scanner.scan(a),d.publish("jails:ready")},d.refresh=function(a){d.scanner.scan(a)},d.render=function(a,b){d.scanner.scan(a,function(a){d.events.trigger(a,"destroy")}),a.innerHTML=b},d.scanner={entities:{components:{selector:"[data-component]",method:f}},scan:function(a,c){var d,e,g,f=this.entities;g=a||document;for(var h in f)d=f[h],e=b.call(g.querySelectorAll(d.selector)),m(e.reverse(),c||d.method)}},e.prototype.trigger=function(a,b,c){b&&b.constructor==String?m(this.element.querySelectorAll(b),function(b){d.events.trigger(b,a,c)}):d.events.trigger(this.element,a,c)},e.prototype.emit=function(a,b){d.events.trigger(this.element,this.name+":"+a,b)},e.prototype.listen=function(a,b){d.events.on(this.element,a,function(a){b.call(a.target,a,a.detail)})},e.prototype.on=function(a,b,c){c||(c=b,b=null);var e=this.element,f=this._events;return f[c]=function(a){if(!b)return c.call(e,a);for(var d=a.target;d&&d!=e&&d.parentNode;){if(d.matches?d.matches(b):o(d,b)){c.call(d,a);break}d=d.parentNode}},d.events.on(e,a,f[c]),function(){d.events.off(e,a,f[c]),delete f[c]}},e.prototype.publish=a.publish,e.prototype.subscribe=a.subscribe,e.prototype.get=function(a){function e(a){return function(){var e=b.call(arguments);m(c.querySelectorAll(a),function(a){d.events.trigger(a,"execute",e)}),d.events.trigger(c,"execute",e)}}var c=this.element;return a=a.replace(/\//g,"\\/"),e(a)},d});
