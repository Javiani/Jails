!function(a,b){"function"==typeof define&&define.amd?define("jails",b):"object"==typeof exports?module.exports=b(require("jails")):a.jails=b()}(this,function(){function e(b,c){this.name=b,this.element=c,this._events={},a.events.on(c,"execute",i(this,b)),a.events.on(c,"destroy",j(this))}function f(b){function f(e){if(e in a.components){if(g(b,e))return;c=new a.components[e](b,d[e]||{}),c.init&&c.init()}}var c,d=h(b),e=b.getAttribute("component").split(/\s/);n(e,f)}function g(a,b){var c=a["jails#component#"+b];return c?!0:(a["jails#component#"+b]=!0,!1)}function h(a){var c,d,b={};return c=a.previousSibling,c=c&&8==c.nodeType?c:c?c.previousSibling:null,c&&8==c.nodeType&&(d=c.data.replace(/[\n\t]/g,"").replace(/\@([a-zA-z0-9-\/]*)\(([^@]*)\)/g,function(a,c,d){b[c]=new Function("return "+d)()})),b}function i(a,b){return function(c){if(c.detail){var d,e,f,g;d=o(c.detail),e=d.shift(),f=e.split(/\:/),g=f.length>1&&f[0]==b?a[f[1]]:a[f[0]],g&&g.apply(a,d)}c.stopPropagation()}}function j(b){return function(c){for(var d in b._events)a.events.off(b.element,b._events[d]);for(d in b)b[d]=null;b=null,c.stopPropagation()}}function k(){return function(b,c){function d(a,d){e.call(this,b,a),c.call(this,a,d)}return d.prototype=e.prototype,a.components[b]=d,d}}function l(){var a={},b={};return{subscribe:function(){var d=c.call(arguments),e=d[0],f=d[1],g=this;return e in b&&a[e]?(a[e].push(f),g.publish.apply(null,[e].concat(b[e]))):(a[e]=a[e]||[],a[e].push(f)),function(){var c=[],d=[];n(a[e],function(a){a!=f&&newarr.push(a)}),a[e]=c,n(b[e],function(a){a!=f&&newarr.push(a)}),b[e]=d}},publish:function(){var d=c.call(arguments),e=d.shift();a[e]=a[e]||[],a[e].length?n(a[e],function(a){a&&a.apply(this,d)}):b[e]=d}}}function m(){function b(a,b){var c=document.createEvent(a);return b=b||{},c.initEvent(a,b.bubbles||!1,b.cancelable||!1,b.detail||null),c}var a=function(){try{var a=new CustomEvent("c",{detail:{foo:"b"}});if("c"===a.type&&"b"===a.detail.foo)return CustomEvent}catch(b){return function(a,b){var c=document.createEvent("CustomEvent");return b=b||{},c.initCustomEvent(a,b.bubbles||!1,b.cancelable||!1,b.detail||null),c}}}();return{on:function(){return function(a,b,c){a.addEventListener(b,c,"focus"==b||"blur"==b)}}(),off:function(a,b,c){a.removeEventListener(b,c,!1)},trigger:function(c,d,e){try{c.dispatchEvent(new b(d,{bubbles:!0,detail:e}))}catch(f){c.dispatchEvent(new a(d,{bubbles:!0,detail:e}))}}}}function n(a,b){for(var c=0,d=a?a.length:0;d>c;c++)b(a[c],c)}function o(a){var b=function(){};return b.prototype=a,new b}function p(a,b){for(var c=a.parentNode.querySelectorAll(b),d=c.length,e=0;d>e;e++)if(c[e]===a)return!0;return!1}var a={},b=l(),c=Array.prototype.slice;document.documentElement;return a.events=m(),a.publish=b.publish,a.subscribe=b.subscribe,a.data={},a.components={},a.component=k(),a.Component=e,a.start=function(b){a.scanner.scan(b),a.publish("jails:ready")},a.refresh=function(b){a.scanner.scan(b)},a.render=function(b,c){a.scanner.scan(b,function(b){a.events.trigger(b,"destroy")}),b.innerHTML=c},a.scanner={entities:{components:{selector:"[component]",method:f}},scan:function(a,b){var d,e,g,f=this.entities;g=a||document;for(var h in f)d=f[h],e=c.call(g.querySelectorAll(d.selector)),n(e.reverse(),b||d.method)}},e.prototype.trigger=function(b,c,d){c&&c.constructor==String?n(this.element.querySelectorAll(c),function(c){a.events.trigger(c,b,d)}):a.events.trigger(this.element,b,d)},e.prototype.emit=function(b,c){a.events.trigger(this.element,this.name+":"+b,c)},e.prototype.listen=function(b,c){a.events.on(this.element,b,function(a){c.call(a.target,a,a.detail)})},e.prototype.on=function(b,c,d){d||(d=c,c=null);var e=this.element,f=this._events;return f[d]=function(a){if(!c)return d.call(e,a);for(var b=a.target;b&&b!=e&&b.parentNode;){if(b.matches?b.matches(c):p(b,c)){d.call(b,a);break}b=b.parentNode}},a.events.on(e,b,f[d]),function(){a.events.off(e,b,f[d]),delete f[d]}},e.prototype.publish=b.publish,e.prototype.subscribe=b.subscribe,e.prototype.get=function(b){function e(b){return function(){var e=c.call(arguments);n(d.querySelectorAll(b),function(b){a.events.trigger(b,"execute",e)}),a.events.trigger(d,"execute",e)}}var d=this.element;return b=b.replace(/\//g,"\\/"),e(b)},a});
