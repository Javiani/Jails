define(function(){function g(a,b,c,d,e){var f=d["jails-"+c];if(!f){d["jails-"+c]=!0;var g=new a(c,d);b&&b.apply(g,[d,e]),g.init&&g.init()}}function h(b){function e(d){d in a.components&&g(l,a.components[d],d,b,c[d]||{})}var c=i(b),d=b.getAttribute("data-component").replace(/\s/,"").split(/\,/);p(d,e)}function i(a){var c,d,b={};return c=a.previousSibling,c=c&&8==c.nodeType?c:c?c.previousSibling:null,c&&8==c.nodeType&&(d=c.data.replace(/[\n\t]/g,"").replace(/\@([a-zA-z0-9-]*)\(([^@]*)\)/g,function(a,c,d){b[c]=new Function("return "+d)()})),b}function j(b){return function(d){var e;e=d.getAttribute("data-"+b),g(m,a[b+"s"][e],e,d,c)}}function k(b,c){function e(a){if(a.detail){var b=q(a.detail),c=d[b.shift()];c&&c.apply(d,b)}a.stopPropagation()}var d=this;this.name=b,this.trigger=a.events.trigger,a.events.on(c,"execute",e),this.emit=function(d,e){a.events.trigger(c,b+":"+d,e)},this.on=function(b,d,e){e||(e=d,d=null),a.events.on(c,b,function(a){if(!d)return e.call(c,a);for(var b=a.target;b&&b!=c&&b.parentNode;){if(b.matches?b.matches(d):r(b,d)){e.call(b,a);break}b=b.parentNode}})}}function l(a,b){k.apply(this,arguments)}function m(b,c){k.apply(this,arguments),this.publish=d.publish,this.subscribe=d.subscribe,this.listen=function(b,d){a.events.on(c,b,function(a){d.call(a.target,a,a.detail)})},this.x=function(b){return function(){var d=e.call(arguments);p(c.querySelectorAll(b),function(b){a.events.trigger(b,"execute",d)})}}}function n(b,c){return function(d,e){return a[b][d]=e,function(a,b){c.apply(this,[d,a]),e.apply(this,[a,b])}}}function o(){var a={},b={};return{subscribe:function(){var c=e.call(arguments),d=c[0],f=c[1],g=this;d in b&&a[d]?(a[d].push(f),g.publish.apply(null,[d].concat(b[d]))):(a[d]=a[d]||[],a[d].push(f))},publish:function(){var c=e.call(arguments),d=c.shift();a[d]=a[d]||[],a[d].length?p(a[d],function(a){a&&a.apply(this,c)}):b[d]=c}}}function p(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)}function q(a){var b=function(){};return b.prototype=a,new b}function r(a,b){for(var c=a.parentNode.querySelectorAll(b),d=c.length,e=0;d>e;e++)if(c[e]===a)return!0;return!1}function s(){function c(a,b){var c=document.createEvent(a);return b=b||{},c.initEvent(a,b.bubbles||!1,b.cancelable||!1,b.detail||null),c}var a=function(){var a=!1,b=document.lastChild,c=document.createElement("a"),d=function(){a=!0};return c.href="#",c.addEventListener?c.addEventListener("focusin",d):c.onfocusin=d,b.appendChild(c).focus(),b.removeChild(c),a}(),b=function(){try{var a=new CustomEvent("c",{detail:{foo:"b"}});if("c"===a.type&&"b"===a.detail.foo)return CustomEvent}catch(b){return function(a,b){var c=document.createEvent("CustomEvent");return b=b||{},c.initCustomEvent(a,b.bubbles||!1,b.cancelable||!1,b.detail||null),c}}}();return{on:function(){return a?function(a,b,c){var d="focus"==b?"focusin":"blur"==b?"focusout":b;a.addEventListener(d,c,!1)}:function(a,b,c){a.addEventListener(b,c,"focus"==b||"blur"==b)}}(),off:function(a,b,c){a.removeEventListener(b,c,!1)},trigger:function(a,d,e){try{a.dispatchEvent(new c(d,{bubbles:!0,detail:e}))}catch(f){a.dispatchEvent(new b(d,{bubbles:!0,detail:e}))}}}}var a,e,c={},d=o();e=Array.prototype.slice,a={apps:{},controllers:{},components:{},events:s(),app:n("apps",m),controller:n("controllers",m),component:n("components",l),publish:d.publish,subscribe:d.subscribe,start:function(a){f.scan(a),document.documentElement.className+="ready"},refresh:function(a){f.scan(a)},data:function(){return c},scanner:function(){return f},render:function(b,c){f.scan(b,function(b){a.events.trigger(b,"execute","destroy")}),b.innerHTML=c}};var f={scan:function(a,b){var c,d,f,e=this.entities;f=a||document;for(var g in e)c=e[g],d=f.querySelectorAll(c.selector),p(d,b||c.method)},entities:{components:{selector:"[data-component]",method:h},controllers:{selector:"[data-controller]",method:j("controller")},app:{selector:"[data-app]",method:j("app")}}};return a});
