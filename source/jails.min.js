define(function(){function h(a,b,c,d,e){var f=new a(c,d);b&&b.apply(f,[d,e]),f.init&&f.init()}function i(b){function e(d){d in a.components&&h(l,a.components[d],d,b,c[d]||{})}var c=j(b),d=b.getAttribute("data-component").replace(/\s/,"").split(/\,/);d.forEach(e)}function j(a){var c,d,b={};return c=a.previousSibling,c=c?c.previousSibling:null,c&&8==c.nodeType&&(d=c.data.replace(/[\n\t]/g,"").replace(/\@([a-zA-z0-9-]*)\(([^@]*)\)/g,function(a,c,d){b[c]=new Function("return "+d)()})),b}function k(b){return function(d){var e;e=d.getAttribute("data-"+b),h(m,a[b+"s"][e],e,d,c)}}function l(a,b){function d(a){var b=p(a.detail);if(b){var d=c[b.shift()];d&&d.apply(c,b)}}this.name=a;var c=this;b.addEventListener("execute",d),this.emit=function(c,d){b.dispatchEvent(new f(a+":"+c,{bubbles:!0,detail:d}))},this.listen=function(a,c){b.addEventListener(a,function(a){c.call(a.target,a,a.detail||{})})}}function m(a,b){l.apply(this,arguments),this.publish=d.publish,this.subscribe=d.subscribe,this.watch=function(a,c,d){b.addEventListener(c,function(c){for(var e=c.target;e&&e!=b&&e.parentNode;)e==e.parentNode.querySelector(a)&&d.call(e,c),e=e.parentNode})},this.x=function(a){return function(){var c=e.call(arguments);[].forEach.call(b.querySelectorAll(a),function(a){a.dispatchEvent(new f("execute",{detail:c}))})}}}function n(b,c){return function(d,e){return a[b][d]=e,function(a,b){c.apply(this,[d,a]),e.apply(this,[a,b])}}}function o(){var a={};return{subscribe:function(){var b=e.call(arguments),c=b[0],d=b[1];a[c]=a[c]||[],a[c].push(d)},publish:function(){var b=e.call(arguments),c=b.shift();a[c]=a[c]||[],a[c].forEach(function(a){a&&a.apply(this,b)})}}}function p(a){var b=function(){};return b.prototype=a,new b}var a,e,f,c={},d=o();e=Array.prototype.slice,a={context:null,apps:{},controllers:{},components:{},app:n("apps",m),controller:n("controllers",m),component:n("components",l),publish:d.publish,subscribe:d.subscribe,start:function(a){g.scan(a),document.documentElement.className+="ready"},refresh:function(a){g.scan(a)},data:function(){return c},scanner:function(){return g}};var g={scan:function(a){var b,c,d=this.entities;for(var f in d)b=d[f],c=e.call((a||document).querySelectorAll(b.selector)),c.forEach(b.method)},entities:{components:{selector:"[data-component]",method:i},controllers:{selector:"[data-controller]",method:k("controller")},app:{selector:"[data-app]",method:k("app")}}};return f=function(){try{var a=new CustomEvent("c",{detail:{foo:"b"}});if("c"===a.type&&"b"===a.detail.foo)return CustomEvent}catch(b){return"function"==typeof document.createEvent?function(a,b){var c=document.createEvent("CustomEvent");return b=b||{},c.initCustomEvent(a,b.bubbles||!1,b.cancelable||!1,b.detail||null),c}:function(a,b){var c=document.createEventObject();return c.type=a,b?(c.bubbles=Boolean(b.bubbles),c.cancelable=Boolean(b.cancelable),c.detail=b.detail):(c.bubbles=!1,c.cancelable=!1,c.detail=void 0),c}}}(),a});
