define(function(){function n(){var n={};return{subscribe:function(){var t=a.call(arguments),e=t[0],o=t[1];n[e]=n[e]||[],n[e].push(o)},publish:function(){var t=a.call(arguments),e=t.shift();n[e]=n[e]||[],n[e].forEach(function(n){n&&n.apply(this,t)})}}}function t(n){var t="component"!=n?"app":n;return function(o,a){return this instanceof e[n]?void s[t].call(this,arguments[2],arguments[1]):e[n+"s"][o]=function(n,e){s[t].call(this,o,n),a.call(this,n,e)}}}var e,o,a,r={},i=n();a=Array.prototype.slice,e={context:null,config:{},apps:{},controllers:{},components:{},app:t("app"),controller:t("controller"),component:t("component"),publish:i.publish,subscribe:i.subscribe,start:function(n,t){o=n.base,e.context=o(document.documentElement),o.extend(!0,e.config,n),c.start(t),e.context.addClass("ready")},refresh:function(n){c.start(n)},data:function(){return r},scanner:function(){return c}};var c={start:function(n){var t=[];n=n||e.context,c.scan("component","[data-component]",n,t),c.scan("controller","[data-controller]",n,t),c.scan("app","[data-app]",n,t),s.start(t)},scan:function(n,t,a,r){a=a||e.context;var i,s,u,l;s=a.get(0).querySelectorAll(t),u=s.length;for(var p=0;u>p;p++)i=o(s[p]),l=c[n],l?l(n,i,r):c.module(n,i,r)},module:function(n,t,o){var a,i,c="s";a=t.data(n),i=e[n+c][a],i=i?new i(t,r):new s[n](a,t,n),o.push(i)},component:function(n,t,a){var r,i,u,l;r=t.data(n),l=c.annotations(r,t),i=r.replace(/\s/g,"").split(/\,/),o.each(i,function(o,r){u=e.components[r],u=u?new u(t,r in l?l[r]:{}):new s[n](r,t),a.push(u)})},annotations:function(n,t){var e,o,a={};return e=t.get(0).previousSibling,e=e?e.previousSibling:null,e&&8==e.nodeType&&(o=e.data.replace(/[\n\t]/g,"").replace(/\@([a-zA-z0-9-]*)\(([^@]*)\)/g,function(n,t,e){a[t]=new Function("return "+e)()})),a}},s={start:function(n){for(var t=n.length,e=0;t>e;e++)n[e].init&&n[e].init();n=null},common:function(n,t){var e=this;this.name=n,this.emit=function(e,o){o=a.call(arguments),o.shift(),t.trigger(n+":"+e,{args:o,element:t.get(0)})},this.listen=function(n,o){if(o)t.on(n,function(n,t){o.apply(t.element,[n].concat(t.args))});else for(var a in n)e.listen(a,n[a])},t.on("execute",function(n,t){var o=[].concat(t.args),a=o.shift(),r=e[a];r&&r.apply(e,o),n.stopPropagation()}),t.on("instance",function(o,a){a.call(e,n,t)})},app:function(n,t){s.common.apply(this,arguments);var e=t.get(0);this.publish=i.publish,this.subscribe=i.subscribe,this.watch=function(n,e,o){t.on(e,n,o)},this.x=function(n){return function(){var e=a.call(arguments);t.find(n).trigger("execute",{args:e})}},this.emit=function(o,r){r=a.call(arguments),r.shift(),t.trigger(n+":"+o,{args:r,element:e})}},component:function(){s.common.apply(this,arguments)}};return e});
