define(function(){function h(a,b,c,d,e){var f=new a(c,d);b&&b.apply(f,[d,e]),f.init&&f.init()}function i(b){function e(d){d in a.components&&h(m,a.components[d],d,b,c[d]||{})}var c=j(b),d=b.getAttribute("data-component").replace(/\s/,"").split(/\,/);q(d,e)}function j(a){var c,d,b={};return c=a.previousSibling,c=c?c.previousSibling:null,c&&8==c.nodeType&&(d=c.data.replace(/[\n\t]/g,"").replace(/\@([a-zA-z0-9-]*)\(([^@]*)\)/g,function(a,c,d){b[c]=new Function("return "+d)()})),b}function k(b){return function(d){var e;e=d.getAttribute("data-"+b),h(n,a[b+"s"][e],e,d,c)}}function l(b,c){function e(a){if(a.detail){var b=d[a.detail.shift()];b&&b.apply(d,a.detail)}a.stopPropagation()}this.name=b;var d=this;a.events.on(c,"execute",e),this.emit=function(d,e){a.events.trigger(c,b+":"+d,e)},this.on=function(b,d,e){e||(e=d,d=null),a.events.on(c,b,function(a){if(d)for(var b=a.target;b&&b!=c&&b.parentNode;)(b.matches?b.matches(d):s(b,d))&&e.call(b,a),b=b.parentNode;else e.call(c,a)})}}function m(b,c){l.apply(this,arguments),this.trigger=a.events.trigger}function n(b,c){l.apply(this,arguments),this.publish=d.publish,this.subscribe=d.subscribe,this.listen=function(b,d){a.events.on(c,b,function(a){d.call(a.target,a,a.detail||{})})},this.x=function(b){return function(){var d=e.call(arguments);q(c.querySelectorAll(b),function(b){a.events.trigger(b,"execute",d)})}}}function o(b,c){return function(d,e){return a[b][d]=e,function(a,b){c.apply(this,[d,a]),e.apply(this,[a,b])}}}function p(){var a={};return{subscribe:function(){var b=e.call(arguments),c=b[0],d=b[1];a[c]=a[c]||[],a[c].push(d)},publish:function(){var b=e.call(arguments),c=b.shift();a[c]=a[c]||[],q(a[c],function(a){a&&a.apply(this,b)})}}}function q(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)}function s(a,b){for(var c=a.parentNode.querySelectorAll(b),d=c.length,e=0;d>e;e++)if(c[e]===a)return!0;return!1}function t(){return{on:function(a,b,c){a.addEventListener(b,c,!1)},off:function(a,b,c){a.removeEventListener(b,c,!1)},trigger:function(a,b,c){a.dispatchEvent(new f(b,{bubbles:!0,detail:c}))}}}var a,e,f,c={},d=p();e=Array.prototype.slice,a={context:null,apps:{},controllers:{},components:{},events:t(),app:o("apps",n),controller:o("controllers",n),component:o("components",m),publish:d.publish,subscribe:d.subscribe,start:function(a){g.scan(a),document.documentElement.className+="ready"},refresh:function(a){g.scan(a)},data:function(){return c},scanner:function(){return g}};var g={scan:function(a){var b,c,d=this.entities;for(var e in d)b=d[e],c=(a||document).querySelectorAll(b.selector),q(c,b.method)},entities:{components:{selector:"[data-component]",method:i},controllers:{selector:"[data-controller]",method:k("controller")},app:{selector:"[data-app]",method:k("app")}}};return f=function(){try{var a=new CustomEvent("c",{detail:{foo:"b"}});if("c"===a.type&&"b"===a.detail.foo)return CustomEvent}catch(b){return function(a,b){var c=document.createEvent("CustomEvent");return b=b||{},c.initCustomEvent(a,b.bubbles||!1,b.cancelable||!1,b.detail||null),c}}}(),a});
