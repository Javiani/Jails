!function(a,b){"function"==typeof define&&define.amd?define("jails",b):"object"==typeof exports?module.exports=b(require("jails")):a.jails=b()}(this,function(){function f(a,b){return f.components[a]=function(c,d){var e=new g(a,c),f=b(e,c,d);return f?Object.assign(e,f):e}}function g(a,b){this.name=a,this.element=b,this._events={},f.events.on(b,"execute",k(this,a)),f.events.on(b,"destroy",l(this))}function h(a){function e(d){if(d in f.components){if(i(a,d))return;b=f.components[d](a,c[d]||{}),b.init&&b.init()}}var b,c=j(a),d=a.getAttribute("data-component").split(/\s/);p(d,e)}function i(a,b){var c=a["jails#component#"+b];return c?!0:(a["jails#component#"+b]=!0,!1)}function j(a){var c,d,b={};return c=a.previousSibling,c=c&&8==c.nodeType?c:c?c.previousSibling:null,c&&8==c.nodeType&&(d=c.data.replace(/[\n\t]/g,"").replace(/\@([a-zA-z0-9-\/]*)\(([^@]*)\)/g,function(a,c,d){b[c]=new Function("return "+d)()})),b}function k(a,b){return function(c){if(c.detail){var d,e,f,g;d=q(c.detail),e=d.shift(),f=e.split(/\:/),g=f.length>1&&f[0]==b?a[f[1]]:a[f[0]],g&&g.apply(a,d)}c.stopPropagation()}}function l(a){return function(b){for(var c in a._events)f.events.off(a.element,a._events[c]);for(c in a)a[c]=null;a=null,b.stopPropagation()}}function m(a){var b,c,d;for(b in a)for(c=a[b],c=c.push?c:[c],d=0;d<c.length;d++)this.on.apply(this,[b].concat(c[d]))}function n(){var a={},c={};return{subscribe:function(){var d=b.call(arguments),e=d[0],f=d[1],g=this;return e in c&&a[e]?(a[e].push(f),g.publish.apply(null,[e].concat(c[e]))):(a[e]=a[e]||[],a[e].push(f)),function(){var b=[],d=[];p(a[e],function(a){a!=f&&newarr.push(a)}),a[e]=b,p(c[e],function(a){a!=f&&newarr.push(a)}),c[e]=d}},publish:function(){var d=b.call(arguments),e=d.shift();a[e]=a[e]||[],a[e].length?p(a[e],function(a){a&&a.apply(this,d)}):c[e]=d}}}function o(){function b(a,b){var c=document.createEvent(a);return b=b||{},c.initEvent(a,b.bubbles||!1,b.cancelable||!1,b.detail||null),c}var a=function(){try{var a=new CustomEvent("c",{detail:{foo:"b"}});if("c"===a.type&&"b"===a.detail.foo)return CustomEvent}catch(b){return function(a,b){var c=document.createEvent("CustomEvent");return b=b||{},c.initCustomEvent(a,b.bubbles||!1,b.cancelable||!1,b.detail||null),c}}}();return{on:function(){return function(a,b,c){a.addEventListener(b,c,"focus"==b||"blur"==b)}}(),off:function(a,b,c){a.removeEventListener(b,c,!1)},trigger:function(c,d,e){try{c.dispatchEvent(new b(d,{bubbles:!0,detail:e}))}catch(f){c.dispatchEvent(new a(d,{bubbles:!0,detail:e}))}}}}function p(a,b){for(var c=0,d=a?a.length:0;d>c;c++)b(a[c],c)}function q(a){var b=function(){};return b.prototype=a,new b}function r(a,b){for(var c=a.parentNode.querySelectorAll(b),d=c.length,e=0;d>e;e++)if(c[e]===a)return!0;return!1}var a=n(),b=Array.prototype.slice,d=(document.documentElement,/\*/),e=":";return f.events=o(),f.publish=a.publish,f.subscribe=a.subscribe,f.data={},f.Component=g,f.components={},f.start=function(a){f.scanner.scan(a),f.publish("jails:ready")},f.refresh=function(a){f.scanner.scan(a)},f.render=function(a,b){f.scanner.scan(a,function(a){f.events.trigger(a,"destroy")}),a.innerHTML=b},f.scanner={entities:{components:{selector:"[data-component]",method:h}},scan:function(a,c){var d,e,g,f=this.entities;g=a||document;for(var h in f)d=f[h],e=b.call(g.querySelectorAll(d.selector)),p(e.reverse(),c||d.method)}},g.prototype.trigger=function(a,b,c){b&&b.constructor==String?p(this.element.querySelectorAll(b),function(b){f.events.trigger(b,a,c)}):f.events.trigger(this.element,a,c)},g.prototype.emit=function(a,b){b=b||{},b._instance=this,f.events.trigger(this.element,e+a,b)},g.prototype.listen=function(a,b){function i(a){var c=a.detail._instance;(d.test(h)||h==c.name)&&b.call(a.target,a,a.detail)}var c=this.element,g=a.split(":"),h=g.shift();return f.events.on(c,e+g.pop(),i),function(){f.events.off(c,a,i)}},g.prototype.on=function(a,b,c){c||(c=b,b=null),a.replace||m.call(this,a),/\:/.test(a)&&this.listen(a,c);var d=this.element,e=this._events;return e[c]=function(a){if(!b)return c.call(d,a);for(var e=a.target;e&&e!=d&&e.parentNode;){if(e.matches?e.matches(b):r(e,b)){c.call(e,a);break}e=e.parentNode}},f.events.on(d,a,e[c]),function(){f.events.off(d,a,e[c]),delete e[c]}},g.prototype.publish=a.publish,g.prototype.subscribe=a.subscribe,g.prototype.get=function(a){function d(a){return function(){var d=b.call(arguments);p(c.querySelectorAll(a),function(a){f.events.trigger(a,"execute",d)}),f.events.trigger(c,"execute",d)}}var c=this.element;return a=a.replace(/\//g,"\\/"),d(a)},Object.assign||(Object.assign=function(a){a=Object(a);for(var b=1,c=arguments.length;c>b;b++){var d=arguments[b];if(null!=d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(a[e]=d[e])}return a}),f});
