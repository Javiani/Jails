!function(a,b){"function"==typeof define&&define.amd?define("jails",b):"object"==typeof exports?module.exports=b(require("jails")):a.jails=b()}(this,function(){function f(b,c){this.name=b,this.element=c,this._events={},a.events.on(c,"execute",l(this,b)),a.events.on(c,"destroy",m(this))}function g(a,b){f.apply(this,arguments)}function h(c){return function(d){var e,f,g=d.getAttribute("data-"+c);!j(d,g,c)&&g&&(f=a[c+"s"][g],f&&(e=new f(d,b),e.init&&e.init()))}}function i(b){function f(e){if(e in a.components){if(j(b,e,"component"))return;c=new a.components[e](b,d[e]||{}),c.init&&c.init()}}var c,d=k(b),e=b.getAttribute("data-component").split(/\s/);q(e,f)}function j(a,b,c){var d=a["jails#"+c+"#"+b];return d?!0:(a["jails#"+c+"#"+b]=!0,!1)}function k(a){var c,d,b={};return c=a.previousSibling,c=c&&8==c.nodeType?c:c?c.previousSibling:null,c&&8==c.nodeType&&(d=c.data.replace(/[\n\t]/g,"").replace(/\@([a-zA-z0-9-\/]*)\(([^@]*)\)/g,function(a,c,d){b[c]=new Function("return "+d)()})),b}function l(a,b){return function(c){if(c.detail){var d,e,f,g;d=r(c.detail),e=d.shift(),f=e.split(/\:/),g=f.length>1&&f[0]==b?a[f[1]]:a[f[0]],g&&g.apply(a,d)}c.stopPropagation()}}function m(b){return function(){for(var c in b._events)a.events.off(b.element,b._events[c]);for(c in b)b[c]=null;b=null}}function n(b,c){return function(d,e){function f(a,c){b.call(this,d,a),e.call(this,a,c)}f.prototype=b.prototype,a[c][d]=f}}function o(){var a={},b={};return{subscribe:function(){var c=d.call(arguments),e=c[0],f=c[1],g=this;return e in b&&a[e]?(a[e].push(f),g.publish.apply(null,[e].concat(b[e]))):(a[e]=a[e]||[],a[e].push(f)),function(){var c=[],d=[];q(a[e],function(a){a!=f&&newarr.push(a)}),a[e]=c,q(b[e],function(a){a!=f&&newarr.push(a)}),b[e]=d}},publish:function(){var c=d.call(arguments),e=c.shift();a[e]=a[e]||[],a[e].length?q(a[e],function(a){a&&a.apply(this,c)}):b[e]=c}}}function p(){function b(a,b){var c=document.createEvent(a);return b=b||{},c.initEvent(a,b.bubbles||!1,b.cancelable||!1,b.detail||null),c}var a=function(){try{var a=new CustomEvent("c",{detail:{foo:"b"}});if("c"===a.type&&"b"===a.detail.foo)return CustomEvent}catch(b){return function(a,b){var c=document.createEvent("CustomEvent");return b=b||{},c.initCustomEvent(a,b.bubbles||!1,b.cancelable||!1,b.detail||null),c}}}();return{on:function(){return function(a,b,c){a.addEventListener(b,c,"focus"==b||"blur"==b)}}(),off:function(a,b,c){a.removeEventListener(b,c,!1)},trigger:function(c,d,e){try{c.dispatchEvent(new b(d,{bubbles:!0,detail:e}))}catch(f){c.dispatchEvent(new a(d,{bubbles:!0,detail:e}))}}}}function q(a,b){for(var c=0,d=a?a.length:0;d>c;c++)b(a[c],c)}function r(a){var b=function(){};return b.prototype=a,new b}function s(a,b){for(var c=a.parentNode.querySelectorAll(b),d=c.length,e=0;d>e;e++)if(c[e]===a)return!0;return!1}var a={},b={},c=o(),d=Array.prototype.slice;document.documentElement;return a.events=p(),a.publish=c.publish,a.subscribe=c.subscribe,a.apps={},a.controllers={},a.components={},a.app=n(g,"apps"),a.component=n(f,"components"),a.controller=n(g,"controllers"),a.App=g,a.Controller=g,a.Component=f,a.start=function(b){a.scanner.scan(b),a.publish("jails:ready")},a.refresh=function(b){a.scanner.scan(b)},a.data=function(){return b},a.render=function(b,c){a.scanner.scan(b,function(b){a.events.trigger(b,"destroy")}),b.innerHTML=c},a.scanner={entities:{components:{selector:"[data-component]",method:i},controllers:{selector:"[data-controller]",method:h("controller")},app:{selector:"[data-app]",method:h("app")}},scan:function(a,b){var c,d,f,e=this.entities;f=a||document;for(var g in e)c=e[g],d=f.querySelectorAll(c.selector),q(d,b||c.method)}},f.prototype.trigger=function(b,c,d){c&&c.constructor==String?q(this.element.querySelectorAll(c),function(c){a.events.trigger(c,b,d)}):a.events.trigger(this.element,b,d)},f.prototype.emit=function(b,c){a.events.trigger(this.element,this.name+":"+b,c)},f.prototype.on=function(b,c,d){d||(d=c,c=null);var e=this.element,f=this._events;return f[d]=function(a){if(!c)return d.call(e,a);for(var b=a.target;b&&b!=e&&b.parentNode;){if(b.matches?b.matches(c):s(b,c)){d.call(b,a);break}b=b.parentNode}},a.events.on(e,b,f[d]),function(){a.events.off(e,b,f[d]),delete f[d]}},g.prototype=f.prototype,g.prototype.publish=c.publish,g.prototype.subscribe=c.subscribe,g.prototype.listen=function(b,c){a.events.on(this.element,b,function(a){c.call(a.target,a,a.detail)})},g.prototype.x=function(b){var c=this.element;return function(){var e=d.call(arguments);q(c.querySelectorAll(b),function(b){a.events.trigger(b,"execute",e)})}},g.prototype.get=function(a,b){return b?(b=b.replace(/\//,"\\/"),this.x("[data-"+a+"*="+b+"]")):this.x(a)},a});
