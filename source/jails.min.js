!function(a,b){"function"==typeof define&&define.amd?define("jails",b):"object"==typeof exports?module.exports=b(require("jails")):a.jails=b()}(this,function(){function e(a,b){return e.components[a]=function(c,d){var e=new f(a,c),g=b(e,c,d);return g?Object.assign(e,g):e}}function f(a,b){this.name=a,this.element=b,this._events={},e.events.on(b,"execute",j(this,a)),e.events.on(b,"destroy",k(this))}function g(a){function f(d){if(d in e.components){if(h(a,d))return;b=e.components[d](a,c[d]||{}),b.init&&b.init()}}var b,c=i(a),d=a.getAttribute("data-component").split(/\s/);n(d,f)}function h(a,b){var c=a["jails#component#"+b];return c?!0:(a["jails#component#"+b]=!0,!1)}function i(a){var c,d,b={};return c=a.previousSibling,c=c&&8==c.nodeType?c:c?c.previousSibling:null,c&&8==c.nodeType&&(d=c.data.replace(/[\n\t]/g,"").replace(/\@([a-zA-z0-9-\/]*)\(([^@]*)\)/g,function(a,c,d){b[c]=new Function("return "+d)()})),b}function j(a,b){return function(c){if(c.detail){var d,e,f,g;d=o(c.detail),e=d.shift(),f=e.split(/\:/),g=f.length>1&&f[0]==b?a[f[1]]:a[f[0]],g&&g.apply(a,d)}c.stopPropagation()}}function k(a){return function(b){for(var c in a._events)e.events.off(a.element,a._events[c]);for(c in a)a[c]=null;a=null,b.stopPropagation()}}function l(){var a={},c={};return{subscribe:function(){var d=b.call(arguments),e=d[0],f=d[1],g=this;return e in c&&a[e]?(a[e].push(f),g.publish.apply(null,[e].concat(c[e]))):(a[e]=a[e]||[],a[e].push(f)),function(){var b=[],d=[];n(a[e],function(a){a!=f&&newarr.push(a)}),a[e]=b,n(c[e],function(a){a!=f&&newarr.push(a)}),c[e]=d}},publish:function(){var d=b.call(arguments),e=d.shift();a[e]=a[e]||[],a[e].length?n(a[e],function(a){a&&a.apply(this,d)}):c[e]=d}}}function m(){function b(a,b){var c=document.createEvent(a);return b=b||{},c.initEvent(a,b.bubbles||!1,b.cancelable||!1,b.detail||null),c}var a=function(){try{var a=new CustomEvent("c",{detail:{foo:"b"}});if("c"===a.type&&"b"===a.detail.foo)return CustomEvent}catch(b){return function(a,b){var c=document.createEvent("CustomEvent");return b=b||{},c.initCustomEvent(a,b.bubbles||!1,b.cancelable||!1,b.detail||null),c}}}();return{on:function(){return function(a,b,c){a.addEventListener(b,c,"focus"==b||"blur"==b)}}(),off:function(a,b,c){a.removeEventListener(b,c,!1)},trigger:function(c,d,e){try{c.dispatchEvent(new b(d,{bubbles:!0,detail:e}))}catch(f){c.dispatchEvent(new a(d,{bubbles:!0,detail:e}))}}}}function n(a,b){for(var c=0,d=a?a.length:0;d>c;c++)b(a[c],c)}function o(a){var b=function(){};return b.prototype=a,new b}function p(a,b){for(var c=a.parentNode.querySelectorAll(b),d=c.length,e=0;d>e;e++)if(c[e]===a)return!0;return!1}var a=l(),b=Array.prototype.slice,d=(document.documentElement,/\*/);return e.events=m(),e.publish=a.publish,e.subscribe=a.subscribe,e.data={},e.Component=f,e.components={},e.start=function(a){e.scanner.scan(a),e.publish("jails:ready")},e.refresh=function(a){e.scanner.scan(a)},e.render=function(a,b){e.scanner.scan(a,function(a){e.events.trigger(a,"destroy")}),a.innerHTML=b},e.scanner={entities:{components:{selector:"[data-component]",method:g}},scan:function(a,c){var d,e,g,f=this.entities;g=a||document;for(var h in f)d=f[h],e=b.call(g.querySelectorAll(d.selector)),n(e.reverse(),c||d.method)}},f.prototype.trigger=function(a,b,c){b&&b.constructor==String?n(this.element.querySelectorAll(b),function(b){e.events.trigger(b,a,c)}):e.events.trigger(this.element,a,c)},f.prototype.emit=function(a,b){b=b||{},b._instance=this,e.events.trigger(this.element,a,b)},f.prototype.listen=function(a,b){function h(a){var c=a.detail._instance;delete a.detail._instance,(d.test(g)||g==c.name)&&b.call(a.target,a,a.detail)}var c=this.element,f=a.split(":"),g=f.shift();return e.events.on(c,f.pop(),h),function(){e.events.off(c,a,h)}},f.prototype.on=function(a,b,c){c||(c=b,b=null);var d=this.element,f=this._events;return f[c]=function(a){if(!b)return c.call(d,a);for(var e=a.target;e&&e!=d&&e.parentNode;){if(e.matches?e.matches(b):p(e,b)){c.call(e,a);break}e=e.parentNode}},e.events.on(d,a,f[c]),function(){e.events.off(d,a,f[c]),delete f[c]}},f.prototype.publish=a.publish,f.prototype.subscribe=a.subscribe,f.prototype.get=function(a){function d(a){return function(){var d=b.call(arguments);n(c.querySelectorAll(a),function(a){e.events.trigger(a,"execute",d)}),e.events.trigger(c,"execute",d)}}var c=this.element;return a=a.replace(/\//g,"\\/"),d(a)},Object.assign||(Object.assign=function(a){a=Object(a);for(var b=1,c=arguments.length;c>b;b++){var d=arguments[b];if(null!=d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(a[e]=d[e])}return a}),e});
