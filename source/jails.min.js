!function(e,n){"function"==typeof define&&define.amd?define("jails",n):"object"==typeof exports?module.exports=n(require("jails")):e.jails=n()}(this,function(){function e(t,r){e.components[t]=function(e,i){var o=new n(t,e);return r(o,e,i)||o}}function n(n,t){this.name=n,this.element=t,this._events={},e.events.on(t,"execute",o(this,n)),e.events.on(t,"destroy",u(this))}function t(n){function t(t){if(t in e.components){if(r(n,t))return;o=e.components[t](n,u[t]||{}),o.init&&o.init()}}var o,u=i(n),c=n.getAttribute("component").split(/\s/);a(c,t)}function r(e,n){var t=e["jails#component#"+n];return t?!0:(e["jails#component#"+n]=!0,!1)}function i(e){var n,t,r={};return n=e.previousSibling,n=n&&8==n.nodeType?n:n?n.previousSibling:null,n&&8==n.nodeType&&(t=n.data.replace(/[\n\t]/g,"").replace(/\@([a-zA-z0-9-\/]*)\(([^@]*)\)/g,function(e,n,t){r[n]=Function("return "+t)()})),r}function o(e,n){return function(t){if(t.detail){var r,i,o,u;r=l(t.detail),i=r.shift(),o=i.split(/\:/),u=o.length>1&&o[0]==n?e[o[1]]:e[o[0]],u&&u.apply(e,r)}t.stopPropagation()}}function u(n){return function(t){for(var r in n._events)e.events.off(n.element,n._events[r]);for(r in n)n[r]=null;n=null,t.stopPropagation()}}function c(){var e={},n={};return{subscribe:function(){var t=v.call(arguments),r=t[0],i=t[1],o=this;return r in n&&e[r]?(e[r].push(i),o.publish.apply(null,[r].concat(n[r]))):(e[r]=e[r]||[],e[r].push(i)),function(){var t=[],o=[];a(e[r],function(e){e!=i&&newarr.push(e)}),e[r]=t,a(n[r],function(e){e!=i&&newarr.push(e)}),n[r]=o}},publish:function(){var t=v.call(arguments),r=t.shift();e[r]=e[r]||[],e[r].length?a(e[r],function(e){e&&e.apply(this,t)}):n[r]=t}}}function s(){function e(e,n){var t=document.createEvent(e);return n=n||{},t.initEvent(e,n.bubbles||!1,n.cancelable||!1,n.detail||null),t}var n=function(){try{var e=new CustomEvent("c",{detail:{foo:"b"}});if("c"===e.type&&"b"===e.detail.foo)return CustomEvent}catch(n){return function(e,n){var t=document.createEvent("CustomEvent");return n=n||{},t.initCustomEvent(e,n.bubbles||!1,n.cancelable||!1,n.detail||null),t}}}();return{on:function(){return function(e,n,t){e.addEventListener(n,t,"focus"==n||"blur"==n)}}(),off:function(e,n,t){e.removeEventListener(n,t,!1)},trigger:function(t,r,i){try{t.dispatchEvent(new e(r,{bubbles:!0,detail:i}))}catch(o){t.dispatchEvent(new n(r,{bubbles:!0,detail:i}))}}}}function a(e,n){for(var t=0,r=e?e.length:0;r>t;t++)n(e[t],t)}function l(e){var n=function(){};return n.prototype=e,new n}function f(e,n){for(var t=e.parentNode.querySelectorAll(n),r=t.length,i=0;r>i;i++)if(t[i]===e)return!0;return!1}{var p=c(),v=Array.prototype.slice;document.documentElement}return e.events=s(),e.publish=p.publish,e.subscribe=p.subscribe,e.data={},e.Component=n,e.components={},e.start=function(n){e.scanner.scan(n),e.publish("jails:ready")},e.refresh=function(n){e.scanner.scan(n)},e.render=function(n,t){e.scanner.scan(n,function(n){e.events.trigger(n,"destroy")}),n.innerHTML=t},e.scanner={entities:{components:{selector:"[data-component]",method:t}},scan:function(e,n){var t,r,i,o=this.entities;i=e||document;for(var u in o)t=o[u],r=v.call(i.querySelectorAll(t.selector)),a(r.reverse(),n||t.method)}},n.prototype.trigger=function(n,t,r){t&&t.constructor==String?a(this.element.querySelectorAll(t),function(t){e.events.trigger(t,n,r)}):e.events.trigger(this.element,n,r)},n.prototype.emit=function(n,t){e.events.trigger(this.element,this.name+":"+n,t)},n.prototype.listen=function(n,t){e.events.on(this.element,n,function(e){t.call(e.target,e,e.detail)})},n.prototype.on=function(n,t,r){r||(r=t,t=null);var i=this.element,o=this._events;return o[r]=function(e){if(!t)return r.call(i,e);for(var n=e.target;n&&n!=i&&n.parentNode;){if(n.matches?n.matches(t):f(n,t)){r.call(n,e);break}n=n.parentNode}},e.events.on(i,n,o[r]),function(){e.events.off(i,n,o[r]),delete o[r]}},n.prototype.publish=p.publish,n.prototype.subscribe=p.subscribe,n.prototype.get=function(n){function t(n){return function(){var t=v.call(arguments);a(r.querySelectorAll(n),function(n){e.events.trigger(n,"execute",t)}),e.events.trigger(r,"execute",t)}}var r=this.element;return n=n.replace(/\//g,"\\/"),t(n)},e});
